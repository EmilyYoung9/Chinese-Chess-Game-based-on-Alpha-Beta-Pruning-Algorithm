# alpha-beta剪枝算法实现中国象棋人机对弈

数据科学与计算机学院	2018级	软件过程	杨玲	18342115

**摘要：**本次实验我们基于Alpha-Beta剪枝算法设计了一个中国象棋博弈程序， 并综合考虑了棋力，攻击能力，保护能力多种因素设计了棋局的静态评估函数。通过实验结果反映出该静态评估函数的设计能够比较好地引导程序进行攻击和防守，在深度为2的搜索树上取得了比较好的效果。

## 一、问题介绍

​		编写一个中国象棋博弈程序，要求用alpha-beta剪枝算法，可以实现人机对弈。棋局评估方法可以参考已有文献，要求具有下棋界面，界面编程也可以参考网上程序，但正式实验报告要引用参考过的文献和程序。

​		因为是人机博弈，因此我们需要使得电脑比较聪明，而方法就是要电脑选择走比较好的步骤。机器是基于搜索来下棋的，我们需要让机器考虑比较长远的情况，然后做出比较好的选择，而为了提高搜索效率，就应用到了alpha-beta剪枝算法。



## 二、中国象棋规则介绍

​		中国象棋是起源于中国的一种棋，属于二人对抗性游戏的一种，在中国有着悠久的历史。由于用具简单，趣味性强，成为流行极为广泛的棋艺活动。
​		中国象棋使用方形格状棋盘，圆形棋子共有32个，红黑二色各有16个棋子，摆放和活动在交叉点上。双方交替行棋，先把对方的将（帅）“将死”的一方获胜。

​		中国象棋是由两人轮流走子，在战法上遵循古代孙子兵法中的“不战而屈人之兵，善之善者也”的作战思想，以“将死”或“困毙”对方将（帅）为胜的一种二人对抗性游戏。对局时，由执红棋的一方先走，双方轮流各走一招，直至分出胜、负、和，对局即终了。在棋战中，人们可以从攻与防、虚与实、整体与局部等复杂关系的变化中提升思维能力。

### 行棋规定

1. 对局开始前，双方棋子在棋盘上的摆法见右图。
2. 对局时，由执红棋的一方先走，双方轮流走一步。
3. 轮到走棋的一方，将某个棋子从一个交叉点走到另一个交叉点，或者吃掉对方的棋子而占领其交叉点，都算走了一着。
4. 双方各走一着，称为一个回合。
5. 走一着棋时，如果己方棋子能够走到的位置有对方棋子存在，就可以把对方棋子吃掉而占领那个位置。
6. 一方的棋子攻击对方的帅（将），并在下一着要把它吃掉，称为“照将”，或简称“将”。“照将”不必声明。被“照将”的一方必须立即“应将”，即用自己的着法去化解被“将”的状态。如果被“照将”而无法“应将”，就算被“将死”。

### 棋例总纲

**棋例释义**

1. 对局中有时出现双方着法循环不变的重复局面。据以裁处这种局面的规则条例，称为《棋例》。
2. [长将](https://baike.baidu.com/item/长将)、长杀、长捉、一将一杀、一将一捉、一杀一捉等循环重复的攻击手段，统称为“禁止着法”。
3. 闲着（含：兑、献、拦、跟）、数将一闲、数杀一闲、数捉一闲等着法，无论是否重复，统称为“允许着法”。
4. 车、马、炮、过河兵（卒）、士、相（象），均算“子力”。帅（将）、未过河兵（卒），不算“子力”。“子力”简称“子”。
5. 子力价值是衡量子力得失的尺度，也是判断是否“捉子”的依据之一。原则上，一车相当于双马、双炮或一马一炮；马炮相等；士相（象）相等；过河兵（卒）价值浮动，一兵换取数子或一子换取数兵均不算得子。

**棋例总则**

1. 在任何情况下，均不允许单方面长将。
2. 双方均为允许着法，双方不变作和。
3. 双方均为禁止着法（不包括一方为长将），双方不变作和。
4. 一方为禁止着法，另一方为允许着法，应由前者变着，不变判负。

**棋例通则**

1. 允许帅（将）本身步步叫吃对方的棋子，按闲着处理。
2. 其他棋子和帅（将）同时捉吃或借帅（将）之力捉吃对方的棋子，均按捉处理。
3. 兵（卒）本身捉吃对方的棋子（不含将杀），按闲处理；如形成相互长打局面，则应按捉处理。
4. 占据防守要点，立即构成简明和棋，附带产生的捉士相（象），按闲处理。
5. 凡走子兼具多种作用时，应从重称呼和裁处。如杀兼捉，按杀；捉兼况，按捉等，依此类推。

### 棋例细则

1. 在任何情况下，均不许可单方面长将。
2. 凡是走子前不存在捉，而走子后造成捉的（即从没捉到捉），一律按捉处理。
3. 凡走子后，预计下一着能在子力价值上构成得子者，均按捉处理。
4. 凡用作为根的子捉吃对方的子，也按捉处理。
5. 凡捉子兼具兑献。送吃，也按捉处理。
6. 凡是原来已经捉着子的子或相关子，走动后无新的捉子行为（即从捉到捉）均捉闲着处理。
7. 凡形式上捉子，一旦吃子立即会被对方将死者,均闲着处理。
8. 双方均为禁止着法（不包括单方面长将），双方不变作和。
9. 其他棋子和帅（将）同时捉吃对方的棋子，均按捉处理。
10. 过河兵（卒）子力价值浮动。
11. 发生互打时，兵（卒）叫吃子均按捉处理。
12. 凡走子兼具多种作用，从重定性。
13. 占据防守要点，立即形成简明和棋,附带产生的捉士、相（象），按闲处理。 [16] 

### 胜负规则

**胜负**

对局中，出现下列情况之一，本方算输，对方赢：

1.己方的帅（将）被对方棋子将死或吃掉；

2.己方无子可走（被困毙）；

3.己方对对方“长将”或“长捉”；

4.己方发出认输请求；

5.有步时要求的，己方走棋超出步时限制；

6.有时间要求的，超过规定时间；

7.违反比赛规则。

**和棋**

出现下列情况之一，为和棋：

1.双方均无可能取胜的简单局势；

2.一方提议作和，另一方表示同意；

3.双方走棋出现循环反复三次，符合《棋例》中“不变作和”的有关规定；

4.符合自然限着的回合规定，即在连续60个回合中（也可根据比赛等级酌减），双方都没有吃过一个棋子。



## 三、算法介绍

对于博弈问题，我们首先考虑的是**极小极大搜索算法**。我们规定：MAX代表程序方，MIN代表对手方，P代表一个棋局（即一个状态）。有利于MAX的势态，f ( P ) f(P)*f*(*P*)取正值；有利于MIN的势态，f ( P ) f(P)*f*(*P*)取负值；势态均衡，f ( P ) f(P)*f*(*P*)取零。f ( P ) f(P)*f*(*P*)的大小由棋局势态的优劣来决定。评估棋局的静态函数要考虑两个方面的因素：

- 双方都知道自己走到了什么程度
- 双方都知道下一步能够做什么

  基于这个前提，博弈双方要考虑的问题是：如何产生一个最好的走步，能尽快获胜。因此，就引出来**极小极大搜索算法**。

  **极小极大搜索的基本思想是：**

1. 当轮到MIN走步的节点时，MAX应考虑最坏的情况（因此，f ( P ) f(P)*f*(*P*)取极小值）。
2. 当轮到MAX走步的节点时，MAX应考虑最好额情况（因此，f ( P ) f(P)*f*(*P*)取极大值）。
3. 当评价往回倒退时，相应于两位棋手的对抗策略，不同层上交替地使用1、2两种方法向上传递倒推值。

  MIN、MAX过程将生成后继节点与估计格局两个过程分开考虑，即需要先生成全部搜索树，然后再进行每个节点的静态估计和倒推值计算。实际上，这种方法效率极低。而alpha-beta基于这个过程，给了我们一个高效的算法。在极大层中定义下界值α \alpha*α*，它表明该MAX节点向上的倒推值不会小于α \alpha*α*；在极小层中定义上界值β \beta*β*，它表明该MIN节点向上的倒推值不会大于β \beta*β*。

  剪枝规则如下：

1. α \alpha*α*剪枝。若任一极小层节点的β \beta*β*值不大于它任一前驱极大层节点的α \alpha*α*值，即α \alpha*α*（前驱层）≥ β \ge \beta≥*β*（后继层），则可以中止该极小层中这个MIN节点以下的搜索过程。这个MIN节点最终的倒推值就确定为这个β \beta*β*值。
2. β \beta*β*剪枝。若任一极大层节点的α \alpha*α*值不小于它任一前驱极小层节点的β \beta*β*值，即α \alpha*α*（后继层）≥ β \ge \beta≥*β*（前驱层），则可以中止该极大层中这个MAX节点以下的搜索过程。这个MAX节点最终的倒推值就确定为这个α \alpha*α*值。

